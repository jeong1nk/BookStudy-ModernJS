- **🏷️클로저의 핵심 키워드: 함수가 선언된 렉시컬 환경**

# 24.1. 렉시컬 스코프
- **🏷️렉시컬 스코프(정적 스코프): 자바스크립트 엔진은 함수를 어디서 정의했는지에 따라 상위 스코프를 결정한다.**
```javascript
const x = 1;

function foo() {
  const x = 10;
  bar();
}

function bar() {
  console.log(x);
}

foo(); // 1
bar(); // 1
```
- 함수 foo와 bar의 상위 스코프는 전역이다. 함수를 어디서 호출하는지는 함수의 상위 스코프 결정에 어떠한 영향도 주지 못한다.
- 🏷️스코프 체인: 스코프의 실체는 실행 컨텍스트의 렉시컬 환경이며, 렉시컬 환경은 자신의 "외부 렉시컬 환경에 대한 참조"를 통해 "상위 렉시컬 환경과 연결"된다.
- 따라서 "함수의 상위 스코프를 결정한다" = "렉시컬 환경의 외부 렉시컬 환경에 대한 참조에 저장할 참조값을 결정한다"
- **"외부 렉시컬 환경에 대한 참조"에 저장할 참조값 = 상위 렉시컬 환경에 대한 참조 = 상위 스코프**
<br />

-**렉시컬 환경의 "외부 렉시컬 환경에 대한 참조"에 저장할 참조값, 즉 상위 스코프에 대한 참조는 함수 정의가 평가되는 시점에 함수가 정의된 환경(위치)에 의해 결정된다. 이것이 🏷️렉시컬 스코프이다.**
- **🔖렉시컬 환경: 실행할 스코프 범위 안에 있는 변수와 함수를 프로퍼티로 저장하는 객체**
  
# 24.2 함수 객체의 내부 슬롯 [[Enviroment]]
- 함수는 자신이 호출되는 환경(위치)와는 상관없이 자신이 정의된 환경(위치), 즉 상위 스코프(함수 정의가위치하는 스코프)를 기억해야한다. 
- **함수는 자신의 내부 슬롯 [[Enviroment]]에 자신이 정의된 환경, 즉 상위 스코프의 참조를 저장한다.**
- 자신의 내부 슬롯 [[Enviroment]]에 저장된 상위 스코프의 참조는 **현재 실행 중인 실행 컨텍스트의 렉시컬 환경을 가리킨다.**
- **전역에서 정의된 함수 선언문**은 **전역 코드가 평가되는 시점**에 평가되어 함수 객체를 생성하고, 함수 객체의 내부 슬롯 [[Enviroment]]에 **전역 렉시컬 환경의 참조가 저장된다.**
- **함수 내부에서 정의된 함수 표현식**은 **외부 함수 코드가 실행되는 시점**에 평가되어 함수 객체를 생성하고, 함수 객체의 내부 슬롯 [[Enviroment]]에 **외부 함수 렉시컬 환경의 참조가 저장된다.**
- => 따라서 함수 객체의 내부 슬롯 [[Enviroment]]에 저장된 **현재 실행 중인 실행 컨텍스트의 렉시컬 환경의 참조**가 **바로 상위 스코프다.** 또한 자신이 호출되었을 때 생성될 함수 렉시컬 환경의 "외부 렉시컬 환경에 대한 참조"에 저장될 참조 값이다.

```javascript
const x = 1;

function foo() {
  const x = 10;

  // 상위 스코프는 함수 정의 환경(위치)에 따라 결정된다.
  // 함수 호출 위치와 상위 스코프는 아무런 관계가 없다.
  bar();
}

// 함수 bar는 자신의 상위 스코프, 즉 전역 렉시컬 환경을 [[Environment]]에 저장하여 기억한다.
function bar() {
  console.log(x);
}

foo(); // ?
bar(); // ?
```
- 함수 foo와 bar는 전역에서 함수 선언문을  ㅗ정의되었으므로, 전역 코드가 평가되는 시점에 평가되어 함수 객체를 생성하고 전역 객체 window의 메서드가 된다.
- 이때 생성한 함수 객체의 내부 슬롯 [[Environment]]에는 함수 정의가 평가된 시점, 즉 전역 코드 평가 시점에 실행 중인 실행 컨텍스트의 렉시컬 환경인 전역 렉시컬 환경의 참조가 저장된다.
- 함수 렉시컬 환경의 구성 요소인 **외부 렉시컬 환경에 대한 참조에는 함수 객체의 내부 슬롯 [[Environment]]에 저장된 렉시컬 환경의 참조가 할당된다.**

# 23.4. 클로저와 렉시컬 환경
